<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Comparison of Functions for PCA • LearnPCA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A Comparison of Functions for PCA">
<meta property="og:description" content="LearnPCA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LearnPCA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Vig_01_Start_Here.html">A Guide to the LearnPCA Package</a>
    </li>
    <li>
      <a href="../articles/Vig_02_Conceptual_Intro_PCA.html">A Conceptual Introduction to PCA</a>
    </li>
    <li>
      <a href="../articles/Vig_03_Step_By_Step_PCA.html">Step-by-Step PCA</a>
    </li>
    <li>
      <a href="../articles/Vig_04_Scores_Loadings.html">Understanding Scores and Loadings</a>
    </li>
    <li>
      <a href="../articles/Vig_05_Visualizing_PCA_3D.html">Visualizing PCA in 3D</a>
    </li>
    <li>
      <a href="../articles/Vig_06_Math_Behind_PCA.html">The Math Behind PCA</a>
    </li>
    <li>
      <a href="../articles/Vig_07_Functions_PCA.html">A Comparison of Functions for PCA</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bryanhanson/LearnPCA/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Comparison of Functions for PCA</h1>
                        <h4 data-toc-skip class="author">David T. Harvey<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h4>
                        <h4 data-toc-skip class="author">Bryan A. Hanson<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2022-07-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bryanhanson/LearnPCA/blob/HEAD/vignettes/Vig_07_Functions_PCA.Rmd" class="external-link"><code>vignettes/Vig_07_Functions_PCA.Rmd</code></a></small>
      <div class="hidden name"><code>Vig_07_Functions_PCA.Rmd</code></div>

    </div>

    
    
<!-- This chunk inserts common info about all the vignettes -->
<!-- ======================================================================= -->
<div class="top-matter">
<p><em>This vignette is based upon <code>LearnPCA</code> version 0.2.1.</em></p>
<p><code>LearnPCA</code> provides the following vignettes: <a name="top-matter"></a></p>
<ul>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Start_Here.html" class="external-link">Start Here</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Conceptual_Intro_PCA.html" class="external-link">A Conceptual Introduction to PCA</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Step_By_Step_PCA.html" class="external-link">Step By Step PCA</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles//Scores_Loadings.html" class="external-link">Understanding Scores &amp; Loadings</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Visualizing_PCA_3D.html" class="external-link">Visualizing PCA in 3D</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Math_Behind_PCA.html" class="external-link">The Math Behind PCA</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Functions_PCA.html" class="external-link">PCA Functions</a></li>
<li>To access the vignettes with <code>R</code>, simply type <code>browseVignettes("LearnPCA")</code> to get a clickable list in a browser window.</li>
</ul>
<p><strong>Vignettes are available in both pdf (on CRAN) and html formats (at Github). </strong></p>
</div>
<!-- ======================================================================= -->
<p>There are four base functions in <code>R</code> that can carry out PCA analysis.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> In this vignette we will look at each of these functions and how they differ.</p>
<div class="section level2">
<h2 id="prcomp">
<code>prcomp</code><a class="anchor" aria-label="anchor" href="#prcomp"></a>
</h2>
<p><code>prcomp</code> is probably the function most people will use for PCA, as it will handle input data sets of arbitrary dimensions (meaning, the number of observations <span class="math inline">\(n\)</span> may be greater or less than the number of measured variables, <span class="math inline">\(p\)</span>). <code>prcomp</code> can do centering or scaling for you, but it also recognizes when the data passed to it has been previously centered or scaled via the <code>scale</code> function.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> Internally, <code>prcomp</code> is a wrapper for the <code>svd</code> function (which we’ll discuss below). This means that <code>prcomp</code> uses <code>svd</code> “under the hood” and repackages the results from <code>svd</code> in a more useful form.</p>
</div>
<div class="section level2">
<h2 id="princomp">
<code>princomp</code><a class="anchor" aria-label="anchor" href="#princomp"></a>
</h2>
<p>In contrast to <code>prcomp</code>, <code>princomp</code> cannot directly handle the situation where <span class="math inline">\(p &gt; n\)</span>, so it is not as flexible. In addition, <code>princomp</code> uses function <code>eigen</code> under the hood, and <code>eigen</code> only accepts square matrices as input (where <span class="math inline">\(n = p\)</span>). However, <code>princomp</code> will accept a rectangular matrix with <span class="math inline">\(n &gt; p\)</span> because internally <code>princomp</code> will convert the input matrix to either the covariance or correlation matrix before passing the new matrix to <code>eigen</code> (the choice depends upon the arguments). Both the covariance and correlation matrices are square matrices that <code>eigen</code> can process. As we shall see below, they give the same scores as the raw data (as long as the scaling is consistent).</p>
</div>
<div class="section level2">
<h2 id="covariance">Covariance<a class="anchor" aria-label="anchor" href="#covariance"></a>
</h2>
<p>Let’s take quick look at covariance and correlation. First, we’ll create some data to play with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4 5</span></span></code></pre>
<p>If you center the columns of <span class="math inline">\(A\)</span>, take <span class="math inline">\(A^TA\)</span> and then divide by <span class="math inline">\(n -1\)</span> you get the <strong>covariance</strong> matrix. We can verify this via the built-in function <code>cov</code>. Covariance describes how the variables track each other. Covariance is unbounded, which means its values can range over <span class="math inline">\(\pm \infty\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">A</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">covA</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Ac</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Ac</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Ac</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">covA</span><span class="op">)</span> <span class="co"># it's square</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5 5</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">covA</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="correlation">Correlation<a class="anchor" aria-label="anchor" href="#correlation"></a>
</h2>
<p>If instead you center the columns of <span class="math inline">\(A\)</span>, i.e. scale the columns by dividing by their standard deviations, take <span class="math inline">\(A^TA\)</span> and then divide by <span class="math inline">\(n -1\)</span> you get the <strong>correlation</strong> matrix. Like covariance, correlation describes how the variables track each other. However, correlation is bounded on <span class="math inline">\([-1, 1]\)</span>. In effect, correlation is covariance normalized to a constant scale. Again we can verify this with the built-in function <code>cor</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">A</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">corA</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Acs</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Acs</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Acs</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">corA</span><span class="op">)</span> <span class="co"># square like covA</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5 5</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">corA</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Importantly, the covariance and correlation matrices contain the same information about the relationship of the original variables, so that PCA of either of these matrices or the original data matrix will give the same results. This will be demonstrated in the next section.</p>
</div>
<div class="section level2">
<h2 id="prcomp-vs-princomp">
<code>prcomp</code> vs <code>princomp</code><a class="anchor" aria-label="anchor" href="#prcomp-vs-princomp"></a>
</h2>
<p>Let’s compare the results from each function. Let’s use a portion of the <code>mtcars</code> data set that is small enough that we can directly print and inspect the results. Converting to a matrix is not necessary but saves some typing later.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="co"># select every other row to get 10 samples</span></span></code></pre></div>
<p>Next we’ll calculate PCA using both functions. Note that the arguments for <code>prcomp</code> will center and autoscale the data before doing the key computation. For <code>princomp</code>, the data will be centered and the correlation matrix computed and analyzed.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">mt</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">prin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/princomp.html" class="external-link">princomp</a></span><span class="op">(</span><span class="va">mt</span>, cor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="compare-the-scores">Compare the Scores<a class="anchor" aria-label="anchor" href="#compare-the-scores"></a>
</h3>
<p>We can directly examine the results for the scores:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca</span><span class="op">$</span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">##                           PC1         PC2         PC3         PC4         PC5</span></span>
<span><span class="co">## Mazda RX4          -1.0479560  0.02812191  0.20417776 -0.23574115  0.19041257</span></span>
<span><span class="co">## Datsun 710         -1.9187384  0.62012252  0.03701878  0.18764497 -0.22980986</span></span>
<span><span class="co">## Hornet Sportabout   1.2408888 -0.34050957  0.42754323  0.36253075  0.14423806</span></span>
<span><span class="co">## Duster 360          2.0345815 -0.21095796 -0.13943434 -0.29895647 -0.47011484</span></span>
<span><span class="co">## Merc 230           -1.8534734  0.48404256 -0.14340048  0.26855557 -0.16691142</span></span>
<span><span class="co">## Merc 280C          -0.6943891  0.26998531 -0.09844637 -0.54336861  0.22228448</span></span>
<span><span class="co">## Merc 450SL          1.1825263  0.02862923  0.67289539 -0.07586040 -0.04125809</span></span>
<span><span class="co">## Cadillac Fleetwood  2.6175010  0.33221478 -0.40782360  0.17057754  0.39558239</span></span>
<span><span class="co">## Chrysler Imperial   2.1330076 -0.38158713 -0.35443033  0.11037449 -0.13208565</span></span>
<span><span class="co">## Honda Civic        -3.6939483 -0.83006166 -0.19810003  0.05424331  0.08766235</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prin</span><span class="op">$</span><span class="va">scores</span></span></code></pre></div>
<pre><code><span><span class="co">##                        Comp.1      Comp.2      Comp.3      Comp.4      Comp.5</span></span>
<span><span class="co">## Mazda RX4           1.1046426 -0.02964310  0.21522225 -0.24849299 -0.20071247</span></span>
<span><span class="co">## Datsun 710          2.0225279 -0.65366653  0.03902122  0.19779517  0.24224086</span></span>
<span><span class="co">## Hornet Sportabout  -1.3080117  0.35892860  0.45067014  0.38214097 -0.15204026</span></span>
<span><span class="co">## Duster 360         -2.1446372  0.22236922 -0.14697670 -0.31512779  0.49554455</span></span>
<span><span class="co">## Merc 230            1.9537325 -0.51022565 -0.15115738  0.28308243  0.17594008</span></span>
<span><span class="co">## Merc 280C           0.7319504 -0.28458951 -0.10377159 -0.57276081 -0.23430841</span></span>
<span><span class="co">## Merc 450SL         -1.2464922 -0.03017786  0.70929402 -0.07996388  0.04348984</span></span>
<span><span class="co">## Cadillac Fleetwood -2.7590883 -0.35018513 -0.42988382  0.17980451 -0.41698045</span></span>
<span><span class="co">## Chrysler Imperial  -2.2483874  0.40222815 -0.37360237  0.11634493  0.13923050</span></span>
<span><span class="co">## Honda Civic         3.8937634  0.87496181 -0.20881577  0.05717747 -0.09240423</span></span></code></pre>
<p>Notice that the absolute values of the scores are similar, but not identical. This is because different algorithms were used in each case. Notice too that the pattern of positive and negative values is complex, it’s not as if one is simply the negative of the other. We’ll have more to say about this momentarily.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">prin</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Mean relative difference: 0.0513167"</span></span></code></pre>
<p>Another way to compare these results is to overlay a plot of the scores from each method. Figure <a href="#fig:overlayScores">1</a> shows the results. The pattern of positive and negative scores becomes much clearer in this plot.</p>
<div class="figure">
<span style="display:block;" id="fig:overlayScores"></span>
<img src="Vig_07_Functions_PCA_files/figure-html/overlayScores-1.png" alt="Comparison of scores computed by `prcomp` (black points) and `princomp` (pink points). Note that they are related by a 180 degreee rotation about an axis out of paper at the origin (plus a little wiggle due to algorithm differences)." width="672"><p class="caption">
Figure 1: Comparison of scores computed by <code>prcomp</code> (black points) and <code>princomp</code> (pink points). Note that they are related by a 180 degreee rotation about an axis out of paper at the origin (plus a little wiggle due to algorithm differences).
</p>
</div>
</div>
<div class="section level3">
<h3 id="compare-the-loadings">Compare The Loadings<a class="anchor" aria-label="anchor" href="#compare-the-loadings"></a>
</h3>
<p>Let’s do the same for the loadings. For the <code>princomp</code> results we have to extract the loadings because they are stored in an usual form by today’s practices.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca</span><span class="op">$</span><span class="va">rotation</span></span></code></pre></div>
<pre><code><span><span class="co">##             PC1        PC2        PC3        PC4        PC5</span></span>
<span><span class="co">## mpg  -0.4436384 -0.5668868  0.3843013  0.4943128 -0.2996526</span></span>
<span><span class="co">## cyl   0.4445134 -0.5119978  0.5168597 -0.3609456  0.3779423</span></span>
<span><span class="co">## disp  0.4496206 -0.3071229 -0.4852451  0.6128739  0.3040389</span></span>
<span><span class="co">## hp    0.4545077 -0.2474375 -0.1952584 -0.2123927 -0.8055811</span></span>
<span><span class="co">## drat -0.4436856 -0.5108305 -0.5581934 -0.4523805  0.1611437</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prin_loads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">prin</span><span class="op">$</span><span class="va">loadings</span>, ncol <span class="op">=</span> <span class="fl">5</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">prin_loads</span></span></code></pre></div>
<pre><code><span><span class="co">##            [,1]      [,2]       [,3]       [,4]       [,5]</span></span>
<span><span class="co">## [1,]  0.4436384 0.5668868  0.3843013  0.4943128  0.2996526</span></span>
<span><span class="co">## [2,] -0.4445134 0.5119978  0.5168597 -0.3609456 -0.3779423</span></span>
<span><span class="co">## [3,] -0.4496206 0.3071229 -0.4852451  0.6128739 -0.3040389</span></span>
<span><span class="co">## [4,] -0.4545077 0.2474375 -0.1952584 -0.2123927  0.8055811</span></span>
<span><span class="co">## [5,]  0.4436856 0.5108305 -0.5581934 -0.4523805 -0.1611437</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">prin_loads</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>The absolute value of the loadings from each method are identical, while the actual pattern of positive and negative values is complex as we saw for the scores. Why is this? Recall from the <a href="#top-matter">Understanding Scores and Loadings</a> vignette that the loadings are the cosines of the angles through which the original axes are rotated to get to the new coordinate system. As cosine is a periodic function, if one rotates the reference frame 30 degrees to line up with the data better, the same alignment can also be achieved by rotating 30 + 180 degrees or 30 - 180 degrees. However, the latter two operations will give the opposite sign for the cosine value. This is the origin of the pattern of signs in the loadings; essentially there are positive and negative cosine values that both describe the needed reorientation equally well. Once the sign of the first value is chosen, the signs of the other values are meaningful only in that context.</p>
<p>As for the scores, a visual comparison of the results from each method will help us understand the relationship. In this case, we’ll just look at the signs of the loadings, and we’ll display the loadings for PC1 followed by the loadings for PC2 etc. Figure <a href="#fig:compareLoads">2</a> makes clear that the two methods return loadings which sometimes have the same sign, and sometimes the opposite sign.</p>
<div class="figure">
<span style="display:block;" id="fig:compareLoads"></span>
<img src="Vig_07_Functions_PCA_files/figure-html/compareLoads-1.png" alt="A comparison of the signs of the first loadings from `prcomp` (black circles) and `princomp` (pink circles). Where the circles coincide, the value of the loading from each method is the same. " width="480"><p class="caption">
Figure 2: A comparison of the signs of the first loadings from <code>prcomp</code> (black circles) and <code>princomp</code> (pink circles). Where the circles coincide, the value of the loading from each method is the same.
</p>
</div>
<p>The key takeaway here is that regardless of the signs of the scores and the loadings, the results from a particular function are internally consistent.</p>
</div>
<div class="section level3">
<h3 id="compare-the-variance-explained">Compare the Variance Explained<a class="anchor" aria-label="anchor" href="#compare-the-variance-explained"></a>
</h3>
<p>For completeness, let’s make sure that each method returns the same variance explained values.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pca</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Importance of components:</span></span>
<span><span class="co">##                           PC1     PC2     PC3    PC4     PC5</span></span>
<span><span class="co">## Standard deviation     2.1297 0.44706 0.34311 0.2846 0.25636</span></span>
<span><span class="co">## Proportion of Variance 0.9071 0.03997 0.02354 0.0162 0.01314</span></span>
<span><span class="co">## Cumulative Proportion  0.9071 0.94711 0.97066 0.9869 1.00000</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">prin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Importance of components:</span></span>
<span><span class="co">##                           Comp.1     Comp.2     Comp.3     Comp.4    Comp.5</span></span>
<span><span class="co">## Standard deviation     2.1297181 0.44706195 0.34311033 0.28459249 0.2563571</span></span>
<span><span class="co">## Proportion of Variance 0.9071398 0.03997288 0.02354494 0.01619858 0.0131438</span></span>
<span><span class="co">## Cumulative Proportion  0.9071398 0.94711269 0.97065763 0.98685620 1.0000000</span></span></code></pre>
<p>Clearly the numerical results are the same. You can see that the labeling of the results is different between the two functions. These labels are internally stored attributes. In the several places below we’ll ignore those labels and just check that the numerical output is the same.</p>
</div>
<div class="section level3">
<h3 id="reconstruct-the-original-data">Reconstruct the Original Data<a class="anchor" aria-label="anchor" href="#reconstruct-the-original-data"></a>
</h3>
<p>While the pattern of positive and negative scores and loadings differs between algorithms, in any particular case the signs of the loadings and scores work together properly. We can use the function <code>PCAtoXhat</code> from this package to reconstruct the original data, and compare it to the known original data. This function recognizes the results from either <code>prcomp</code> or <code>princomp</code> and reconstructs the original data, accounting for any scaling and centering.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MTpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCAtoXhat.html">PCAtoXhat</a></span><span class="op">(</span><span class="va">pca</span><span class="op">)</span> <span class="co"># not checking attributes as the internal labeling varies between functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">MTpca</span>, <span class="va">mt</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MTprin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCAtoXhat.html">PCAtoXhat</a></span><span class="op">(</span><span class="va">prin</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">MTprin</span>, <span class="va">mt</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>As you can see each function is reconstructing the data faithfully. And in the process we have shown that one gets the same results starting from either the centered and scaled original matrix, or the matrix which has been centered, scaled and then converted to its correlation matrix. Hence either approach extracts the same information, proving that the correlation matrix contains the same relationships that are present in the raw data.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
</div>
</div>
<div class="section level2">
<h2 id="svd">
<code>svd</code><a class="anchor" aria-label="anchor" href="#svd"></a>
</h2>
<p>As stated earlier, <code>prcomp</code> uses <code>svd</code> under the hood. Therefore we should be able to show that either function gives the same results. The key difference is that <code>svd</code> is “bare bones” and we have to prepare the data ourselves, and reconstruct the data ourselves. Let’s go.</p>
<p>First, we’ll center and scale the data, because <code>svd</code> doesn’t provide such conveniences.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mt_cen_scl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">mt</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Then conduct <code>svd</code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">mt_cen_scl</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="compare-to-the-scores-from-prcomp">Compare to the Scores from <code>prcomp</code><a class="anchor" aria-label="anchor" href="#compare-to-the-scores-from-prcomp"></a>
</h3>
<p>The math behind extracting the scores and loadings is discussed more fully in the <a href="#top-matter">Math Behind PCA</a> vignette. Here we use the results shown there to compare scores and loadings.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svd_scores</span> <span class="op">&lt;-</span> <span class="va">mt_cen_scl</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">sing</span><span class="op">$</span><span class="va">v</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">svd_scores</span>, <span class="va">pca</span><span class="op">$</span><span class="va">x</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="compare-to-the-loadings-from-prcomp">Compare to the Loadings from <code>prcomp</code><a class="anchor" aria-label="anchor" href="#compare-to-the-loadings-from-prcomp"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">sing</span><span class="op">$</span><span class="va">v</span>, <span class="va">pca</span><span class="op">$</span><span class="va">rotation</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="eigen">
<code>eigen</code><a class="anchor" aria-label="anchor" href="#eigen"></a>
</h2>
<p><code>princomp</code> uses <code>eigen</code> under the hood, and so we should be able to show that these functions give the same results. Like <code>svd</code>, <code>eigen</code> is “bare bones” so we’ll start from the centered and scaled data set. In this case however, we also need to compute the correlation matrix, something that <code>princomp</code> did for us, but <code>eigen</code> expects you to provide a square matrix (either raw data that happens to be square, but more likely the covariance or correlation matrix).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mt_cen_scl_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">mt_cen_scl</span><span class="op">)</span></span>
<span><span class="va">eig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">mt_cen_scl_cor</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="compare-to-the-scores-from-princomp">Compare to the Scores from <code>princomp</code><a class="anchor" aria-label="anchor" href="#compare-to-the-scores-from-princomp"></a>
</h3>
<p>As we discovered earlier, we need to take the absolute value prior to comparison.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eig_scores</span> <span class="op">&lt;-</span> <span class="va">mt_cen_scl</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">eig</span><span class="op">$</span><span class="va">vectors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">eig_scores</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">prin</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Mean relative difference: 0.05409255"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="compare-to-the-loadings-from-princomp">Compare to the Loadings from <code>princomp</code><a class="anchor" aria-label="anchor" href="#compare-to-the-loadings-from-princomp"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">eig</span><span class="op">$</span><span class="va">vectors</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">prin_loads</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="wrap-up">Wrap Up<a class="anchor" aria-label="anchor" href="#wrap-up"></a>
</h2>
<p>Table <a href="#tab:SumTable">1</a> summarizes much of what we covered above.</p>
<table style="width:100%;" class="table">
<caption>
<span id="tab:SumTable">Table 1: </span>A comparison of R functions for PCA. Input data must be centered in all cases. Scaling is optional.</caption>
<colgroup>
<col width="12%">
<col width="22%">
<col width="20%">
<col width="23%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">prcomp</th>
<th align="left">svd</th>
<th align="left">princomp</th>
<th align="left">eigen</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">algorithm</td>
<td align="left">uses svd</td>
<td align="left">svd</td>
<td align="left">uses eigen</td>
<td align="left">eigen</td>
</tr>
<tr class="even">
<td align="left">input dimensions</td>
<td align="left"><span class="math inline">\(n \times p\)</span></td>
<td align="left"><span class="math inline">\(n \times p\)</span></td>
<td align="left"><span class="math inline">\(n \times p\)</span></td>
<td align="left"><span class="math inline">\(n \times n\)</span></td>
</tr>
<tr class="odd">
<td align="left">user pre-processing</td>
<td align="left">center; scale</td>
<td align="left">center; scale</td>
<td align="left">don’t do it!</td>
<td align="left">center; scale; cov or cor</td>
</tr>
<tr class="even">
<td align="left">internal pre-processing</td>
<td align="left">center; scale</td>
<td align="left">none</td>
<td align="left">center; cov or cor</td>
<td align="left">none</td>
</tr>
<tr class="odd">
<td align="left">call</td>
<td align="left"><span class="math inline">\(pca \leftarrow prcomp(X)\)</span></td>
<td align="left"><span class="math inline">\(sing \leftarrow svd(X)\)</span></td>
<td align="left"><span class="math inline">\(prin \leftarrow princomp(X)\)</span></td>
<td align="left"><span class="math inline">\(eig \leftarrow eigen(X)\)</span></td>
</tr>
<tr class="even">
<td align="left">scores</td>
<td align="left"><span class="math inline">\(pca\$x\)</span></td>
<td align="left"><span class="math inline">\(X \times sing\$v\)</span></td>
<td align="left"><span class="math inline">\(prin\$scores\)</span></td>
<td align="left"><span class="math inline">\(X \times eig\$vectors\)</span></td>
</tr>
<tr class="odd">
<td align="left">loadings</td>
<td align="left"><span class="math inline">\(pca\$rotation\)</span></td>
<td align="left"><span class="math inline">\(sing\$v\)</span></td>
<td align="left"><span class="math inline">\(prin\$loadings\)</span></td>
<td align="left"><span class="math inline">\(eig\$vectors\)</span></td>
</tr>
<tr class="even">
<td align="left">pct variance explained</td>
<td align="left"><span class="math inline">\(\cfrac{100*pca\$sdev^2}{sum(pca\$sdev^2)}\)</span></td>
<td align="left"><span class="math inline">\(\cfrac{100*sing\$d^2}{sum(sing\$d^2)}\)</span></td>
<td align="left"><span class="math inline">\(\cfrac{100*prin\$sdev^2}{sum(prin\$sdev^2)}\)</span></td>
<td align="left"><span class="math inline">\(\cfrac{100*eig\$values}{sum(eig\$values)}\)</span></td>
</tr>
</tbody>
</table>
<!-- Insert refer_to_works_consulted document -->
</div>
<div class="section level2">
<h2 id="works-consulted">Works Consulted<a class="anchor" aria-label="anchor" href="#works-consulted"></a>
</h2>
<p>In addition to references and links in this document, please see the <a href="http://bryanhanson.github.io/LearnPCA/articles/Start_Here.html#works-consulted" class="external-link">Works Consulted</a> section of the <em>Start Here</em> vignette for general background.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Professor of Chemistry &amp; Biochemistry, DePauw University, Greencastle IN USA., <a href="mailto:harvey@depauw.edu" class="email">harvey@depauw.edu</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Professor Emeritus of Chemistry &amp; Biochemistry, DePauw University, Greencastle IN USA., <a href="mailto:hanson@depauw.edu" class="email">hanson@depauw.edu</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>And there are numerous functions in user-contributed packages that “wrap” or implement these base functions in particular contexts.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>This works because the <code>scale</code> function adds attributes to its results, and <code>prcomp</code> checks for these attributes and uses them if present.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>In <code>princomp</code> there is no argument regarding centering. The documentation is silent on this. However, if you look at the source code (via <code>stats:::princomp.default</code>) you discover that it calls <code>cov.wt</code> which indeed centers, and gives the covariance matrix unless you set the argument <code>cor = TRUE</code> in which case you get the correlation matrix.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Proof that the covariance matrix gives the same results is left as an exercise!<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bryan A. Hanson, David T. Harvey.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
