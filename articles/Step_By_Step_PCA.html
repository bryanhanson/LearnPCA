<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step-by-Step PCA • LearnPCA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Step-by-Step PCA">
<meta property="og:description" content="LearnPCA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LearnPCA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Conceptual_Intro_PCA.html">A Conceptual Introduction to PCA</a>
    </li>
    <li>
      <a href="../articles/Functions_PCA.html">A Comparison of Functions for PCA</a>
    </li>
    <li>
      <a href="../articles/Math_Behind_PCA.html">The Math Behind PCA</a>
    </li>
    <li>
      <a href="../articles/Scores_Loadings.html">Understanding Scores and Loadings</a>
    </li>
    <li>
      <a href="../articles/Start_Here.html">A Guide to the LearnPCA Package</a>
    </li>
    <li>
      <a href="../articles/Step_By_Step_PCA.html">Step-by-Step PCA</a>
    </li>
    <li>
      <a href="../articles/Visualizing_PCA_3D.html">Visualizing PCA in 3D</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bryanhanson/LearnPCA/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Step-by-Step PCA</h1>
                        <h4 data-toc-skip class="author">David T. Harvey<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h4>
                        <h4 data-toc-skip class="author">Bryan A. Hanson<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2022-02-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bryanhanson/LearnPCA/blob/HEAD/vignettes/Step_By_Step_PCA.Rmd" class="external-link"><code>vignettes/Step_By_Step_PCA.Rmd</code></a></small>
      <div class="hidden name"><code>Step_By_Step_PCA.Rmd</code></div>

    </div>

    
    
<!-- This chunk inserts common info about all the vignettes -->
<!-- ======================================================================= -->
<div class="top-matter">
<p><em>This vignette is based upon <code>LearnPCA</code> version 0.1.1.</em></p>
<p><code>LearnPCA</code> provides the following vignettes: <a name="top-matter"></a></p>
<ul>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Start_Here.html" class="external-link">Start Here</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Conceptual_Intro_PCA.html" class="external-link">A Conceptual Introduction to PCA</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Step_By_Step_PCA.html" class="external-link">Step By Step PCA</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles//Scores_Loadings.html" class="external-link">Understanding Scores &amp; Loadings</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Visualizing_PCA_3D.html" class="external-link">Visualizing PCA in 3D</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Math_Behind_PCA.html" class="external-link">The Math Behind PCA</a></li>
<li><a href="http://bryanhanson.github.io/LearnPCA/articles/Functions_PCA.html" class="external-link">PCA Functions</a></li>
<li>Alternatively, if you are offline or prefer accessing the vignettes with <code>R</code>, simply type <code>browseVignettes("LearnPCA")</code> to get a clickable list in a browser window.</li>
</ul>
<p><strong>Vignettes are available in both pdf and html formats. However, the pdf versions lack certain interactive diagrams, so the html versions are recommended.</strong></p>
</div>
<!-- ======================================================================= -->
<p>In this vignette we’ll walk through the computational and mathematical steps needed to carry out PCA. If you are not familiar with PCA from a conceptual point of view, we strongly recommend you read the <a href="#top-matter">Conceptual Introduction to PCA</a> vignette before proceeding.</p>
<p>The steps to carry out PCA are:</p>
<ol style="list-style-type: decimal">
<li>Center the data</li>
<li>Optionally, scale the data</li>
<li>Carry out data reduction</li>
<li>Optionally, undo any scaling, likely using a limited number of PCs</li>
<li>Optionally, undo the centering, likely using a limited number of PCs</li>
</ol>
<p>We’ll discuss each of these steps in order. For many or most types of analysis, one would just do the first three steps, which provides the scores and loadings that are usually the main result of interest. In some cases, it is desirable to reconstruct the original data from the reduced data set. For that task you needs steps four and five.</p>
<p>To illustrate the process, we’ll use a portion of a data set containing measurements of metal pollutants in the estuary shared by the Tinto and Odiel rivers in southwest Spain. The full data set is found in the package <code>ade4</code>; we’ll use data for just a couple of elements and a few samples. This 16 sample, two variable data set will make it easier to visualize the steps as we go. Table <a href="#tab:metals-raw-table">1</a> shows the values, and we’ll refer to this as the <code>FeCu</code> data set (since we are using the data for iron and copper). It’s important at this point to remember that the samples are in rows, and the variables are in columns. Also, notice that the values for Fe<sub>2</sub>O<sub>3</sub> are in percentages, but the values for Cu are in ppm (parts per million).</p>
<p>Figure <a href="#fig:plot-raw-dotplot">1</a> is a plot showing the range of the values; Figure <a href="#fig:plot-raw-data-2D">2</a> gives another view of the same data, plotting the concentrations of copper against iron.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tintoodiel</span><span class="op">)</span> <span class="co"># activate the data set from package ade4</span>
<span class="va">TO</span> <span class="op">&lt;-</span> <span class="va">tintoodiel</span><span class="op">$</span><span class="va">tab</span> <span class="co"># to save typing, rename the element with the data</span>
<span class="co"># select just a few samples (in rows) &amp; variables (in columns)</span>
<span class="va">FeCu</span> <span class="op">&lt;-</span> <span class="va">TO</span><span class="op">[</span><span class="fl">28</span><span class="op">:</span><span class="fl">43</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fe2O3"</span>, <span class="st">"Cu"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">FeCu</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      Fe2O3             Cu         </span>
<span class="co">##  Min.   : 7.35   Min.   :  1.052  </span>
<span class="co">##  1st Qu.:11.61   1st Qu.:  2.192  </span>
<span class="co">##  Median :13.05   Median :238.000  </span>
<span class="co">##  Mean   :15.38   Mean   :224.496  </span>
<span class="co">##  3rd Qu.:18.73   3rd Qu.:356.250  </span>
<span class="co">##  Max.   :32.40   Max.   :787.000</span></code></pre>
<table class="table table table-striped table-bordered" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:metals-raw-table">Table 1: </span>The FeCu data set. Values for Fe<sub>2</sub>O<sub>3</sub> are percentages, those for Cu are ppm.
</caption>
<thead><tr>
<th style="text-align:right;">
Fe<sub>2</sub>O<sub>3</sub>
</th>
<th style="text-align:right;">
Cu
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
9.50
</td>
<td style="text-align:right;">
594.000
</td>
</tr>
<tr>
<td style="text-align:right;">
7.35
</td>
<td style="text-align:right;">
328.000
</td>
</tr>
<tr>
<td style="text-align:right;">
14.99
</td>
<td style="text-align:right;">
1.674
</td>
</tr>
<tr>
<td style="text-align:right;">
18.50
</td>
<td style="text-align:right;">
2.990
</td>
</tr>
<tr>
<td style="text-align:right;">
7.72
</td>
<td style="text-align:right;">
402.000
</td>
</tr>
<tr>
<td style="text-align:right;">
13.40
</td>
<td style="text-align:right;">
342.000
</td>
</tr>
<tr>
<td style="text-align:right;">
12.40
</td>
<td style="text-align:right;">
1.052
</td>
</tr>
<tr>
<td style="text-align:right;">
11.80
</td>
<td style="text-align:right;">
399.000
</td>
</tr>
<tr>
<td style="text-align:right;">
20.60
</td>
<td style="text-align:right;">
3.670
</td>
</tr>
<tr>
<td style="text-align:right;">
19.40
</td>
<td style="text-align:right;">
2.250
</td>
</tr>
<tr>
<td style="text-align:right;">
25.60
</td>
<td style="text-align:right;">
2.020
</td>
</tr>
<tr>
<td style="text-align:right;">
32.40
</td>
<td style="text-align:right;">
787.000
</td>
</tr>
<tr>
<td style="text-align:right;">
12.00
</td>
<td style="text-align:right;">
238.000
</td>
</tr>
<tr>
<td style="text-align:right;">
11.05
</td>
<td style="text-align:right;">
249.000
</td>
</tr>
<tr>
<td style="text-align:right;">
16.60
</td>
<td style="text-align:right;">
1.278
</td>
</tr>
<tr>
<td style="text-align:right;">
12.70
</td>
<td style="text-align:right;">
238.000
</td>
</tr>
</tbody>
</table>
<div class="figure">
<span style="display:block;" id="fig:plot-raw-dotplot"></span>
<img src="Step_By_Step_PCA_files/figure-html/plot-raw-dotplot-1.png" alt="The range of the raw data values in `FeCu`." width="672"><p class="caption">
Figure 1: The range of the raw data values in <code>FeCu</code>.
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:plot-raw-data-2D"></span>
<img src="Step_By_Step_PCA_files/figure-html/plot-raw-data-2D-1.png" alt="The relationship between the raw data values in `FeCu`." width="672"><p class="caption">
Figure 2: The relationship between the raw data values in <code>FeCu</code>.
</p>
</div>
<div class="section level2">
<h2 id="step-1--centering-the-data">Step 1. Centering the Data<a class="anchor" aria-label="anchor" href="#step-1--centering-the-data"></a>
</h2>
<p>The first step is to center the data.</p>
<p>When we center the data, we take each column, corresponding to a particular variable, and subtract the mean of that column from each value in the column. Thus, regardless of the original values in the column, the centered values are now expressed relative to the mean value for that column. The function <code>scale</code> can do this for us (in spite of its name, <code>scale</code> can both center and scale):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">FeCu_centered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">FeCu</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># see ?scale for defaults</span></code></pre></div>
<p>Figure <a href="#fig:plot-centered-data">3</a> is a plot of the centered values. Note how the values on the y-axis have changed compared to the raw data. It’s apparent that the ranges of the chosen variables are quite different. This is a classic case where scaling is desirable, otherwise the variable with larger values will dominate the PCA results.</p>
<div class="figure">
<span style="display:block;" id="fig:plot-centered-data"></span>
<img src="Step_By_Step_PCA_files/figure-html/plot-centered-data-1.png" alt="Centered data values in `FeCu`." width="672"><p class="caption">
Figure 3: Centered data values in <code>FeCu</code>.
</p>
</div>
<p>Why do we center the data? The easiest way to think about this is that without centering there is an offset in the data, a bit like an intercept in a linear regression. If we don’t remove this offset, it adversely affects the results and their interpretation. There is good discussion of this with illustrations at this <a href="https://stats.stackexchange.com/a/22331/26909" class="external-link">Cross Validated</a> answer if you wish a bit more explanation.</p>
</div>
<div class="section level2">
<h2 id="step-2--scaling-the-data">Step 2. Scaling the Data<a class="anchor" aria-label="anchor" href="#step-2--scaling-the-data"></a>
</h2>
<p>Scaling the data is optional. If the range of the variables (which, recall, are in the columns) are approximately the same, one generally does not scale the data. However, if some variables have much larger ranges, they will dominate the PCA results. You may want this to happen, or you may not, and in many cases it is wise to try different scaling options. As mentioned above, the <code>FeCu</code> data set should be scaled to avoid the Cu values dominating the analysis, since these values are larger.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p>To scale the data, we can use <code>scale</code> again:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">FeCu_centered_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">FeCu_centered</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># see ?scale for defaults</span></code></pre></div>
<p>The default <code>scale = TRUE</code> scales the (already centered) columns by dividing them by their standard deviation. Figure <a href="#fig:plot-centered-scaled-data">4</a> shows the result. This scaling has the effect of making the column standard deviations equal to one:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">FeCu_centered_scaled</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Fe2O3    Cu </span>
<span class="co">##     1     1</span></code></pre>
<p>Put another way, all variables are now on the same scale, which is really obvious from Figure <a href="#fig:plot-centered-scaled-data">4</a>. One downside of this scaling is that if you have variables that may only be noise, the contribution of these variables is the same as variables representing interesting features.</p>
<div class="figure">
<span style="display:block;" id="fig:plot-centered-scaled-data"></span>
<img src="Step_By_Step_PCA_files/figure-html/plot-centered-scaled-data-1.png" alt="Centered and scaled data." width="672"><p class="caption">
Figure 4: Centered and scaled data.
</p>
</div>
</div>
<div class="section level2">
<h2 id="step-3--data-reduction">Step 3. Data Reduction<a class="anchor" aria-label="anchor" href="#step-3--data-reduction"></a>
</h2>
<p>Now we are ready for the actual data reduction process. This is accomplished via the function <code>prcomp</code>.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> <code>prcomp</code> can actually do the centering and scaling for you, should you prefer. But in this case we have already done those steps, so we choose the arguments to <code>prcomp</code> appropriately.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="section level3">
<h3 id="using-prcomp">Using <code>prcomp</code><a class="anchor" aria-label="anchor" href="#using-prcomp"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca_FeCu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">FeCu_centered_scaled</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pca_FeCu</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## List of 5</span>
<span class="co">##  $ sdev    : num [1:2] 1.007 0.992</span>
<span class="co">##  $ rotation: num [1:2, 1:2] 0.707 -0.707 -0.707 -0.707</span>
<span class="co">##   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">##   .. ..$ : chr [1:2] "Fe2O3" "Cu"</span>
<span class="co">##   .. ..$ : chr [1:2] "PC1" "PC2"</span>
<span class="co">##  $ center  : Named num [1:2] 1.15e-16 -6.85e-17</span>
<span class="co">##   ..- attr(*, "names")= chr [1:2] "Fe2O3" "Cu"</span>
<span class="co">##  $ scale   : Named num [1:2] 6.68 243.11</span>
<span class="co">##   ..- attr(*, "names")= chr [1:2] "Fe2O3" "Cu"</span>
<span class="co">##  $ x       : num [1:16, 1:2] -1.697 -1.15 0.607 0.975 -1.327 ...</span>
<span class="co">##   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">##   .. ..$ : chr [1:16] "O-1" "O-2" "O-3" "O-4" ...</span>
<span class="co">##   .. ..$ : chr [1:2] "PC1" "PC2"</span>
<span class="co">##  - attr(*, "class")= chr "prcomp"</span></code></pre>
<p><code>str(pca_FeCu)</code> shows the structure of <code>pca_FeCu</code>, the object that holds the PCA results. A key part is <code>pca_FeCu$x</code>, which holds the scores. Notice that it has 16 rows and two columns, exactly like our original set of data. In general, <code>pca$x</code> will be a matrix with dimensions <code>n</code> <span class="math inline">\(\times\)</span> <code>p</code> where <code>n</code> is the number of samples, and <code>p</code> is the number of variables.</p>
<p>Scores represent the original data but in a new coordinate system. Figure <a href="#fig:plot-scores">5</a> shows the scores.</p>
<div class="figure">
<span style="display:block;" id="fig:plot-scores"></span>
<img src="Step_By_Step_PCA_files/figure-html/plot-scores-1.png" alt="Scores." width="672"><p class="caption">
Figure 5: Scores.
</p>
</div>
</div>
<div class="section level3">
<h3 id="using-all-the-data">Using All the Data<a class="anchor" aria-label="anchor" href="#using-all-the-data"></a>
</h3>
<p>If you compare Figure <a href="#fig:plot-scores">5</a> to Figure <a href="#fig:plot-raw-data-2D">2</a>, it looks broadly similar, but the points are rotated and the scales are different.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> You might ask, what did we really accomplish here? Well, because we are using just a tiny portion of the original data, the multi-dimensional nature of the whole set is obscured. So, just to make the point, let’s repeat everything we’ve done so far, except use all the data (52 samples and 16 variables). Figure <a href="#fig:plot-all-data">6</a> shows the first two principal component scores. A similar plot of the raw data is not possible, because it is not two-dimensional: there are 16 dimensions corresponding to the 16 variables.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca_TO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">TO</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:plot-all-data"></span>
<img src="Step_By_Step_PCA_files/figure-html/plot-all-data-1.png" alt="Score plot using all the data." width="672"><p class="caption">
Figure 6: Score plot using all the data.
</p>
</div>
</div>
<div class="section level3">
<h3 id="what-else-is-in-the-pca-results">What Else is in the PCA Results?<a class="anchor" aria-label="anchor" href="#what-else-is-in-the-pca-results"></a>
</h3>
<p>Earlier we did <code>str(pca)</code> to see what was stored in the results of our PCA. We already considered <code>pca$x</code>. The other elements are:</p>
<ul>
<li>
<code>pca$sdev</code> The standard deviations of the principal components. These are used in the construction of a scree plot (coming up next). The length of <code>pca$sdev</code> is equal to <code>p</code>, the number of variables in the data set.</li>
<li>
<code>pca$rotation</code> These are the loadings, stored in a square matrix with dimensions <code>p</code> <span class="math inline">\(\times\)</span> <code>p</code>
</li>
<li>
<code>pca$center</code> The values used for centering (either calculated by <code>prcomp</code> or passed as attributes from the results of <code>scale</code>). There are <code>p</code> values.</li>
<li>
<code>pca$scale</code> (either calculated by <code>prcomp</code> or passed as attributes from the results of <code>scale</code>). There are <code>p</code> values.</li>
</ul>
<p>The returned information is sufficient to reconstruct the original data set (more on that later).</p>
</div>
<div class="section level3">
<h3 id="scree-plot">Scree Plot<a class="anchor" aria-label="anchor" href="#scree-plot"></a>
</h3>
<p>As mentioned in the <a href="#top-matter">A Conceptual Introduction to PCA</a> vignette, a scree plot shows the amount of variance explained for each PC. These values are simply the square of <code>pca$sdev</code> and can be plotted by calling <code>plot</code> on an object of class <code>prcomp</code>. See Figure <a href="#fig:scree">7</a>. Remember, the more variance explained, the more information a PC carries. From the plot, we can see that both variables contribute about equally to separation in the score plot.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pca_FeCu</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:scree"></span>
<img src="Step_By_Step_PCA_files/figure-html/scree-1.png" alt="Scree plot." width="672"><p class="caption">
Figure 7: Scree plot.
</p>
</div>
</div>
<div class="section level3">
<h3 id="loading-plot">Loading Plot<a class="anchor" aria-label="anchor" href="#loading-plot"></a>
</h3>
<p>To show the loadings, one can use the following code, which gives Figure <a href="#fig:loading1">8</a>. We can see that the Fe<sub>2</sub>O<sub>3</sub> and Cu contribute in opposite directions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">pca_FeCu</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:loading1"></span>
<img src="Step_By_Step_PCA_files/figure-html/loading1-1.png" alt="Plot of the loadings on PC1." width="672"><p class="caption">
Figure 8: Plot of the loadings on PC1.
</p>
</div>
<p>At this point we have looked at each element of a <code>prcomp</code> object and seen what information is stored in it.</p>
</div>
<div class="section level3">
<h3 id="how-does-prcomp-actually-work">How Does <code>prcomp</code> Actually Work?<a class="anchor" aria-label="anchor" href="#how-does-prcomp-actually-work"></a>
</h3>
<p>Please see both the <a href="#top-matter">The Math Behind PCA</a> and <a href="#top-matter">Understanding Scores &amp; Loadings</a> vignettes for a full discussion of the details of the calculation.</p>
</div>
</div>
<div class="section level2">
<h2 id="step-4--undoing-the-scaling">Step 4. Undoing the Scaling<a class="anchor" aria-label="anchor" href="#step-4--undoing-the-scaling"></a>
</h2>
<p>Sometimes it is desirable to reconstruct the original data using a limited number of PCs. If one reconstructs the original data using all the PCs, one gets the original data back. However, for many data sets, the higher PCs don’t represent useful information; effectively they are noise. So using a limited number of PCs one can get back a reasonably faithful representation of the original data.</p>
<p>To reconstruct all or part of the original data, one starts from the object returned by <code>prcomp</code>. If one wants to use the first <code>z</code> PCs to reconstruct the data, one takes the first <code>z</code> scores (in <code>pca$x</code>) and multiplies them by the tranpose of the first <code>z</code> columns of the rotation matrix (in <code>pca$rotation</code>). In <code>R</code> this would be expressed for the <code>pca_FeCu</code> data set as:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Xhat</span> <span class="op">&lt;-</span> <span class="va">pca_FeCu</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="va">z</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pca_FeCu</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="va">z</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>where <code>Xhat</code> is the reconstructed<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a> original matrix.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></p>
<p>We are now ready to undo the scaling, which is accomplished by dividing the columns of <code>Xhat</code> by the scale factors previously employed. Once again the <code>scale</code> function makes it easy to operate on the columns of the matrix.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Xhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Xhat</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">pca_FeCu</span><span class="op">$</span><span class="va">scale</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-5--undoing-the-centering">Step 5. Undoing the Centering<a class="anchor" aria-label="anchor" href="#step-5--undoing-the-centering"></a>
</h2>
<p>Finally, we take the unscaled <code>Xhat</code> and add back the values that we subtracted when centering, again using <code>scale</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Xhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Xhat</span>, center <span class="op">=</span>  <span class="op">-</span><span class="va">pca_FeCu</span><span class="op">$</span><span class="va">center</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>One might think that <code>scale</code> can handle both the unscaling and re-centering processes at the same time. This is not the case, as <code>scale</code> does any (un)centering first, then scales the data. We need to take care of scaling first, and then the centering second. Thus in the forward direction, <code>scale</code> can handle both tasks simultaneously, but in the reconstruction direction, we need to take it step-wise.</p>
</div>
<div class="section level2">
<h2 id="proof-of-perfect-reconstruction">Proof of Perfect Reconstruction<a class="anchor" aria-label="anchor" href="#proof-of-perfect-reconstruction"></a>
</h2>
<p>If we use only a portion of the PCs, an approximation of the original data is returned. If we use all the PCs, then the original data is reconstructed. Let’s make sure this is true for the full <code>tintoodiel</code> data set.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TOhat</span> <span class="op">&lt;-</span> <span class="va">pca_TO</span><span class="op">$</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pca_TO</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span>
<span class="va">TOhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">TOhat</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">pca_TO</span><span class="op">$</span><span class="va">scale</span><span class="op">)</span>
<span class="va">TOhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">TOhat</span>, center <span class="op">=</span> <span class="op">-</span><span class="va">pca_TO</span><span class="op">$</span><span class="va">center</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>If this process worked correctly, there should be no difference between the reconstructed data and the original data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">TOhat</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">TO</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 4.122971e-16</span></code></pre>
<p>The result is a vanishingly small number, so we’ll call it a <em>Success!</em></p>
</div>
<div class="section level2">
<h2 id="the-more-components-used-the-better-the-reconstruction">The More Components Used, the Better the Reconstruction<a class="anchor" aria-label="anchor" href="#the-more-components-used-the-better-the-reconstruction"></a>
</h2>
<p>Figure <a href="#fig:rmsd">9</a> shows how the approximation of the original data set (<code>tintoodiel</code>) improves as more and more PCs are included in the reconstruction. The y-axis represents the error, as the root mean squared deviation of the original data minus the approximation.</p>
<div class="figure">
<span style="display:block;" id="fig:rmsd"></span>
<img src="Step_By_Step_PCA_files/figure-html/rmsd-1.png" alt="Reduction of error as the number of components included in the reconstruction increases." width="672"><p class="caption">
Figure 9: Reduction of error as the number of components included in the reconstruction increases.
</p>
</div>
<!-- Insert refer_to_works_consulted document -->
</div>
<div class="section level2">
<h2 id="works-consulted">Works Consulted<a class="anchor" aria-label="anchor" href="#works-consulted"></a>
</h2>
<p>In addition to references and links in this document, please see the <a href="http://bryanhanson.github.io/LearnPCA/articles/Start_Here.html#works-consulted" class="external-link">Works Consulted</a> section of the <em>Start Here</em> vignette for general background.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Professor of Chemistry &amp; Biochemistry, DePauw University, Greencastle IN USA., <a href="mailto:harvey@depauw.edu" class="email">harvey@depauw.edu</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Professor Emeritus of Chemistry &amp; Biochemistry, DePauw University, Greencastle IN USA., <a href="mailto:hanson@depauw.edu" class="email">hanson@depauw.edu</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The actual numbers are what matter as far as the mathematics of scaling goes. However, in practice, one should pay attention to the units as well. For those that are not chemists, a “ppm” is a much smaller unit than a percentage. If we were to report both metal concentrations in percentages, it would make the Cu values much smaller and it is the Fe<sub>2</sub>O<sub>3</sub> values that would dominate.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>There are other functions in <code>R</code> for carrying out PCA. See the <a href="#top-matter">PCA Functions</a> vignette for the details.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>If one uses <code>scale</code> to center and/or scale your data, the results are tagged with attributes giving the values necessary to undo the calculation. Take a look at <code>str(FeCu_centered_scale)</code> and you’ll see these attributes. Compare the values for <code>attributes(FeCu_centered_scaled)["scaled:center"]</code> to <code>colMeans(FeCu)</code>. Importantly, if you use <code>scale</code> to do your centering and scaling, these attributes are understood by <code>prcomp</code> and are reflected in the returned data, even if <code>prcomp</code> didn’t do the centering and scaling itself. In other words, these two functions are designed to work together.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>This is an important observation that we discuss in the <a href="#top-matter">Understanding Scores &amp; Loadings</a> vignette.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>For the full data set, there are also 16 dimensions in the form of 16 principal components. But, each of the 16 principal components each has a bit of the original 16 raw variables in it, and showing only the first two principal components is meaningful. How meaningful? The scree plot will tell us. Keep reading.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>As an exercise, see what happens to the scree plot if you don’t scale the values.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Why do we call it <code>Xhat</code>? <code>X</code> represents the data matrix. <code>hat</code> is a reference to the use of the symbol <span class="math inline">\(\hat{}\)</span> as in <span class="math inline">\(\hat{X}\)</span> which is often used to designate a reconstruction or estimation of a value in statistics.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Since there are only two columns in <code>FeCu</code>, the largest value of <code>z</code> that one could us is two, which is not very interesting. Keep reading.<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bryan A. Hanson, David T. Harvey.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
